@model REQCYCLER.Projeto

<script type="text/javascript">
    $(document).ready(function () {

        $('.input-append').datepicker({

            todayHighlight: true,
        });

        $('.text-box').addClass('form-control').removeClass('text-box');
        $('#Modal02').addClass('hide').removeClass('modal-body');
        $('#NiveisAprovacao').addClass('hide');

        //$( "#btnProximo" ).click(function() {
        //    $('#Modal01').addClass('hide').removeClass('modal-body');
        //    $('#Modal02').addClass('modal-body').removeClass('hide');
        //});
    })

    function OnSuccess() {
        $('#Modal01').addClass('hide').removeClass('modal-body');
        $('#Modal02').addClass('modal-body').removeClass('hide');
    }

    function OnSuccessNiveisAprovacao() {
        $('#NiveisAprovacao').addClass('modal-body').removeClass('hide');
    }

</script>

<h2>Meus Projetos</h2>

<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
    CRIAR NOVO PROJETO
     <span class="glyphicon glyphicon-plus"></span>
</button>

<br />


<!-- MODAL -->

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

                @{
                    String nomeProjeto = String.Empty;

                    if (HttpContext.Current.Session["TempProjeto"] != null)
                    {
                        nomeProjeto = " - " + ((REQCYCLER.Projeto)HttpContext.Current.Session["TempProjeto"]).nome;
                    }
                    else
                    {
                        nomeProjeto = "";
                    }
                     
                }

                <h4 class="modal-title" id="myModalLabel">Criar Projeto @nomeProjeto</h4>
            </div>
            <div class="modal-body" id="Modal01">

                @using (Ajax.BeginForm("CriarProjeto", "Projeto", new AjaxOptions()
                {
                    HttpMethod = "POST",
                    OnSuccess = "OnSuccess",

                }, new { enctype = "multipart/form-data" }))
                {    
                    <table style="width: 100%;">
                        <tr>
                            <td colspan="2">
                                <div class="form-group">
                                    <label for="nomeProjeto">Projeto Nome</label>
                                    @Html.EditorFor(model => model.nome, new { @class = "form-control projeto" })
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <!-- DATA INICIO PROJETO -->
                                <div class="form-group">
                                    <label>Data Início</label>
                                    <div class="input-append date" id="datepickerInicio" data-date-format="dd/mm/yyyy">
                                        @Html.TextBoxFor(model => model.dataInicio, new { @class = "form-control projeto", @value = String.Empty, @readonly = true, placeholder = "dd/mm/aaaa" })
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <!-- DATA INICIO PROJETO -->
                            </td>
                            <td>
                                <!-- DATA FIM PROJETO -->
                                <div class="form-group">
                                    <label>Data Início</label>
                                    <div class="input-append date" id="datepickerFinal" data-date-format="dd/mm/yyyy">
                                        @Html.TextBoxFor(model => model.dataFim, new { @class = "form-control projeto", @value = String.Empty, @readonly = true, placeholder = "dd/mm/aaaa" })
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <!-- DATA FIM PROJETO -->
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="form-group">
                                    <label>Área</label>
                                    @Html.DropDownListFor(model => model.Area.id, new SelectList(
                                                          new List<SelectListItem>
                                                          { 
                                                              new SelectListItem { Value = "0", Text = "SELECIONE", Selected = true },
                                                              new SelectListItem { Value = "1", Text = "Marketing", Selected = false},
                                                              new SelectListItem { Value = "2", Text = "Financeiro", Selected = false},
                                                              new SelectListItem { Value = "3", Text = "Diretoria", Selected = false},
                                                              new SelectListItem { Value = "4", Text = "Administrativo", Selected = false}
                                                             
                                                           }, "value", "text", "selected"), new { @class = "form-control projeto" })
                                </div>
                            </td>
                            <td>
                                <div class="form-group">
                                    <label>Responsável</label>
                                    @Html.DropDownListFor(model => model.responsavelId, new SelectList(
                                                          new List<SelectListItem>
                                                          { 
                                                              new SelectListItem { Value = "0", Text = "SELECIONE", Selected =  true },
                                                              new SelectListItem { Value = "1", Text = "Administrador", Selected = false},
                                                              new SelectListItem { Value = "2", Text = "Gestor", Selected = false},
                                                              new SelectListItem { Value = "3", Text = "Stakeholder", Selected = false},
                                                              new SelectListItem { Value = "4", Text = "Usuário", Selected = false}
                                                             
                                                           }, "value", "text", "selected"), new { @class = "form-control projeto" })
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <label>Logotipo</label>
                                <div class="editor-field">
                                    <input type="file" name="imageData" class="form-control projeto" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="form-group">
                                    <label>Objetivo</label>
                                    @Html.EditorFor(model => model.objetivo, new { @class = "form-control projeto", rows = "3" })
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="form-group">
                                    <label>Escopo</label>
                                    @Html.EditorFor(model => model.escopo, new { @class = "form-control projeto", rows = "3" })
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="form-group">
                                    <label>Descrição</label>
                                    @Html.EditorFor(model => model.descricao, new { @class = "form-control projeto", rows = "3" })
                                </div>
                            </td>
                        </tr>
                    </table>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                        <button type="submit" id="btnProximo" class="btn btn-primary">Próximo</button>
                    </div>  
                }

            </div>

            <!-- MODAL 02 -->

            <div class="modal-body" id="Modal02">
                <h3>Cadastrar Usuários / Definir Fluxo de Aprovação</h3>
                <br />
                @using (Ajax.BeginForm("DefinirNiveis", "Projeto", new AjaxOptions()
                  {
                      HttpMethod = "POST",
                      OnSuccess = "OnSuccessNiveisAprovacao",
                      UpdateTargetId = "NiveisAprovacao"

                  }))
                { 
                    <table style="width: 100%;">
                        <tr>
                            <td>
                                <div class="form-group">
                                    <label for="nomeProjeto">Número de Níveis</label>
                                    @Html.EditorFor(m => m.NumeroNiveis, new  {@class = "form-control projeto" })
                                </div>
                            </td>
                            <td>
                                <button class="btn btn-primary" type="submit">
                                    ADICIONAR
                                    <span class="glyphicon glyphicon-plus"></span>
                                </button>
                            </td>
                        </tr>
                    </table>
                }

                <!-- NÍVEIS DE APROVAÇÃO: Gerado dinamicamente com Ajax -->
                <div id="NiveisAprovacao">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Concluir</button>
                </div>
            </div>

            <!-- MODAL 02 -->
        </div>
    </div>
</div>

<!-- MODAL -->


<br />

<div class="row">
    @if (ViewData["ListaProjetos"] != null)
    {
        foreach (var item in ViewData["ListaProjetos"] as List<REQCYCLER.Projeto>)
        {

        <div class="col-sm-6 col-md-4">
            <div class="thumbnail">
                <div class="caption">
                    <h2 class="red">@Html.Label(item.nome)</h2>
                </div>
                <img src = "@Url.Action("CarregarLogotipo", "Projeto", new { item.id })" />
                <div class="caption">
                    <p><a href="#" class="btn btn-primary" role="button">Button</a> <a href="#" class="btn btn-default" role="button">Button</a></p>
                </div>
            </div>
        </div>
        }
    }
    else
    {
        <div class="alert alert-danger">
            <h2>Você não possui nenhum projeto</h2>
        </div>     
    }

</div>
