<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" template="/default.xhtml">

	<ui:define name="content">

		<style type="text/css">
		html.progress,html.progress * {
			cursor: progress !important;
		}
		</style>

		<h:form id="form">

			<p:panel header="Manter Projeto">

				<p:growl id="messages" showDetail="true" />
				
				<p:growl id="growlDialog" showDetail="true" />

				<p:dataTable id="projetosDataTable" 
							 var="projeto"
							 widgetVar="projetoTable"
							 value="#{projetoController.projetoList}"
							 paginator="true"
							 rows="10"
							 editable="true"
							 ajax="true"
							 emptyMessage="Nenhum projeto encontrado com os dados informados!"					
							 filteredValue="#{projetoController.projetoFiltroList}">							 							 

					<f:facet name="header">
						<p:outputPanel>						
							<table >							
								<tr style="width: 100%">
									<td style="border-style:none; text-align:left; width: 40%">
										<h:outputText value="Localizar: " />
										<p:inputText id="globalFilter"
													 onkeyup="projetoTable.filter()" />
									</td>
									<td style="border-style: none; text-align:center; width: 20%">
										<p:outputLabel>Projetos</p:outputLabel>
									</td>
									<td style="border-style: none; text-align:right; width: 40%">
										<p:commandButton id="refresh"
											 			 action="#{projetoController.limparProjeto}"
											 			 icon="ui-icon-arrowrefresh-1-w" 
											 			 ajax="true"
											 			 update="projetosDataTable" />
									</td>
								</tr>
							</table>							
						</p:outputPanel>
					</f:facet>

					<p:ajax event="rowEdit"
							listener="#{projetoController.atualizarProjeto}" 
							ajax="true"
							update="projetosDataTable,:form:messages" />
							
					<p:ajax event="rowEditCancel" />
					
					<p:column sortBy="#{projeto.nome}" 
							  filterBy="#{projeto.nome}"
							  headerText="Nome"
							  filterMatchMode="contains"
							  style="max-width: 50px;">
						<p:cellEditor>
							<f:facet name="input">
								<p:inputText value="#{projeto.nome}" />
							</f:facet>
							<f:facet name="output">
								<h:outputText value="#{projeto.nome}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column sortBy="#{projeto.status}" 
							  filterBy="#{projeto.status}"
							  headerText="Status"
							  style="max-width: 50px;">
						<p:cellEditor>
							<f:facet name="input">
								<h:selectOneMenu id="status"
												 value="#{projeto.status}">
									<f:selectItems value="#{projetoController.statusValues}" />
								</h:selectOneMenu>
							</f:facet>
							<f:facet name="output">
								<h:outputText value="#{projeto.status}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column sortBy="#{projeto.sponsor}" 
							  filterBy="#{projeto.sponsor}"
							  headerText="Sponsor" 
							  style="max-width: 50px;">
						<h:outputText value="#{projeto.sponsor.nome}" />
					</p:column>

					<p:column sortBy="#{projeto.dataInicio}"							 
							  headerText="Data Inicio"
							  style="max-width: 50px;">
						<h:outputText value="#{projeto.dataInicio}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
											   timeZone="GMT-03:00" />
						</h:outputText>
					</p:column>

					<p:column sortBy="#{projeto.dataFim}" 							 
							  headerText="Data Fim" 
							  style="max-width: 50px;">
						<h:outputText value="#{projeto.dataFim}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
								timeZone="GMT-03:00" />
						</h:outputText>
					</p:column>

					<p:column headerText="Objetivo"
							  style="max-width: 50px;">
						<p:cellEditor>
							<f:facet name="input">
								<p:inputTextarea value="#{projeto.objetivo}" 
												 rows="6"
												 cols="33" />
							</f:facet>
							<f:facet name="output">
								<h:outputText value="#{projeto.objetivo}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="Escopo"
							  style="max-width: 50px;">
						<p:cellEditor>
							<f:facet name="input">
								<p:inputTextarea value="#{projeto.escopo}"
												 rows="6" 
												 cols="33" />
							</f:facet>
							<f:facet name="output">
								<h:outputText value="#{projeto.escopo}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="Descrição"
						style="max-width: 50px;">
						<p:cellEditor>
							<f:facet name="input">
								<p:inputTextarea value="#{projeto.descricao}" 
												 rows="6" 
												 cols="33" />
							</f:facet>
							<f:facet name="output" >
								<h:outputText value="#{projeto.descricao}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column style="max-width: 5px;" >						
						<p:rowEditor rendered="#{(projeto.status) != 'FECHADO'}" />					
					</p:column>
					
					<p:column style="max-width: 5px;">
			                <p:commandButton id="selectButton" 
			                				 update=":form:display" 
			                				 oncomplete="projetoDialog.show()" 
			                				 icon="ui-icon-search">  
			                <f:setPropertyActionListener value="#{projeto}" 
			                							 target="#{projetoController.projetoSelecionado}" />  
			            </p:commandButton>  
			        </p:column>													

				</p:dataTable>
			</p:panel>
			
			<p:dialog id="dialog" header="Detalhes Projeto" widgetVar="projetoDialog" resizable="false"  
                showEffect="fade" hideEffect="explode" modal="true">  
  
	        <h:panelGrid id="display" columns="2" cellpadding="4">  
	  
		            <h:outputText value="Nome:" />  
		            <h:outputText value="#{projetoController.projetoSelecionado.nome}" />
		            
		            <h:outputText value="Status: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.status}" />
		            
		            <h:outputText value="Sponsor: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.sponsor}" />
		            
		            <h:outputText value="Data Inicio: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.dataInicio}" >
		            		<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
											   timeZone="GMT-03:00" />
					</h:outputText>
		            
		            <h:outputText value="Data Fim: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.dataFim}" >
		            		<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
											   timeZone="GMT-03:00" />
		            </h:outputText>
		            
		            <h:outputText value="Objetivo: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.objetivo}" />
		            
		            <h:outputText value="Escopo: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.escopo}" />
		            
		            <h:outputText value="Descrição: " />  
		            <h:outputText value="#{projetoController.projetoSelecionado.descricao}" />		            
		            
		        </h:panelGrid>  
		    </p:dialog> 

		</h:form>

		<script>
			$(document).ajaxStart(function() {
				$("html").addClass("progress");
			}).ajaxStop(function() {
				$("html").removeClass("progress");
			});
		</script>

	</ui:define>

</ui:composition>